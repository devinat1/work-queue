{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 18, "column": 0}, "map": {"version":3,"sources":["file:///Users/devinat1/Desktop/projects/work-queue/packages/db-client/src/index.ts"],"sourcesContent":["import { PrismaClient } from \"@prisma/client\";\nimport { PrismaPg } from \"@prisma/adapter-pg\";\nimport { Pool } from \"pg\";\n\nconst globalForPrisma = globalThis as unknown as {\n  prisma: PrismaClient | undefined;\n};\n\nfunction createPrismaClient(): PrismaClient {\n  const connectionString = process.env.POSTGRES_PRISMA_URL;\n\n  if (!connectionString) {\n    throw new Error(\"POSTGRES_PRISMA_URL environment variable is required.\");\n  }\n\n  const pool = new Pool({ connectionString });\n  const adapter = new PrismaPg(pool);\n  return new PrismaClient({ adapter });\n}\n\nexport const prisma = globalForPrisma.prisma ?? createPrismaClient();\n\nif (process.env.NODE_ENV !== \"production\") {\n  globalForPrisma.prisma = prisma;\n}\n"],"names":[],"mappings":";;;;AAAA;AACA;AACA;;;;;;;;;AAEA,MAAM,kBAAkB;AAIxB,SAAS;IACP,MAAM,mBAAmB,QAAQ,GAAG,CAAC,mBAAmB;IAExD,IAAI,CAAC,kBAAkB;QACrB,MAAM,IAAI,MAAM;IAClB;IAEA,MAAM,OAAO,IAAI,qJAAI,CAAC;QAAE;IAAiB;IACzC,MAAM,UAAU,IAAI,8NAAQ,CAAC;IAC7B,OAAO,IAAI,sMAAY,CAAC;QAAE;IAAQ;AACpC;AAEO,MAAM,SAAS,gBAAgB,MAAM,IAAI;AAEhD,wCAA2C;IACzC,gBAAgB,MAAM,GAAG;AAC3B"}},
    {"offset": {"line": 58, "column": 0}, "map": {"version":3,"sources":["file:///Users/devinat1/Desktop/projects/work-queue/apps/web/src/lib/auth.ts"],"sourcesContent":["import { betterAuth } from \"better-auth\";\nimport { prismaAdapter } from \"better-auth/adapters/prisma\";\nimport { prisma } from \"@work-queue/db-client\";\n\nexport const auth = betterAuth({\n  database: prismaAdapter(prisma, {\n    provider: \"postgresql\",\n  }),\n  emailAndPassword: {\n    enabled: true,\n  },\n});\n"],"names":[],"mappings":";;;;AAAA;AACA;AACA;;;;;;;;;;AAEO,MAAM,OAAO,IAAA,+LAAU,EAAC;IAC7B,UAAU,IAAA,8OAAa,EAAC,2IAAM,EAAE;QAC9B,UAAU;IACZ;IACA,kBAAkB;QAChB,SAAS;IACX;AACF"}},
    {"offset": {"line": 89, "column": 0}, "map": {"version":3,"sources":["file:///Users/devinat1/Desktop/projects/work-queue/apps/web/helpers/api/auth.ts"],"sourcesContent":["import type { IncomingMessage } from \"http\";\nimport { auth } from \"@/lib/auth\";\nimport { prisma } from \"@work-queue/db-client\";\n\nfunction toHeaders({ req }: { req: IncomingMessage }): Headers {\n  const headerEntries: Record<string, string> = {};\n  for (const [key, value] of Object.entries(req.headers)) {\n    if (value) {\n      headerEntries[key] = Array.isArray(value) ? value.join(\", \") : value;\n    }\n  }\n  return new Headers(headerEntries);\n}\n\nexport async function getSession({ req }: { req: IncomingMessage }) {\n  const session = await auth.api.getSession({\n    headers: toHeaders({ req }),\n  });\n  return session;\n}\n\nexport async function requireAuth({ req }: { req: IncomingMessage }) {\n  const session = await getSession({ req });\n  if (!session) {\n    throw new Error(\"Unauthorized\");\n  }\n  return session;\n}\n\nexport async function requireQueueOwnership({\n  req,\n  shareToken,\n}: {\n  req: IncomingMessage;\n  shareToken: string;\n}) {\n  const session = await requireAuth({ req });\n\n  const queue = await prisma.queue.findUnique({\n    where: { shareToken },\n    select: { userId: true },\n  });\n\n  if (!queue) {\n    throw new Error(\"Queue not found\");\n  }\n\n  if (queue.userId !== session.user.id) {\n    throw new Error(\"Forbidden\");\n  }\n\n  return session;\n}\n\nexport async function isQueueOwner({\n  req,\n  shareToken,\n}: {\n  req: IncomingMessage;\n  shareToken: string;\n}): Promise<boolean> {\n  const session = await getSession({ req });\n  if (!session) {\n    return false;\n  }\n\n  const queue = await prisma.queue.findUnique({\n    where: { shareToken },\n    select: { userId: true },\n  });\n\n  if (!queue) {\n    return false;\n  }\n\n  return queue.userId === session.user.id;\n}\n"],"names":[],"mappings":";;;;;;;;;;AACA;AACA;;;;;;;;AAEA,SAAS,UAAU,EAAE,GAAG,EAA4B;IAClD,MAAM,gBAAwC,CAAC;IAC/C,KAAK,MAAM,CAAC,KAAK,MAAM,IAAI,OAAO,OAAO,CAAC,IAAI,OAAO,EAAG;QACtD,IAAI,OAAO;YACT,aAAa,CAAC,IAAI,GAAG,MAAM,OAAO,CAAC,SAAS,MAAM,IAAI,CAAC,QAAQ;QACjE;IACF;IACA,OAAO,IAAI,QAAQ;AACrB;AAEO,eAAe,WAAW,EAAE,GAAG,EAA4B;IAChE,MAAM,UAAU,MAAM,kIAAI,CAAC,GAAG,CAAC,UAAU,CAAC;QACxC,SAAS,UAAU;YAAE;QAAI;IAC3B;IACA,OAAO;AACT;AAEO,eAAe,YAAY,EAAE,GAAG,EAA4B;IACjE,MAAM,UAAU,MAAM,WAAW;QAAE;IAAI;IACvC,IAAI,CAAC,SAAS;QACZ,MAAM,IAAI,MAAM;IAClB;IACA,OAAO;AACT;AAEO,eAAe,sBAAsB,EAC1C,GAAG,EACH,UAAU,EAIX;IACC,MAAM,UAAU,MAAM,YAAY;QAAE;IAAI;IAExC,MAAM,QAAQ,MAAM,2IAAM,CAAC,KAAK,CAAC,UAAU,CAAC;QAC1C,OAAO;YAAE;QAAW;QACpB,QAAQ;YAAE,QAAQ;QAAK;IACzB;IAEA,IAAI,CAAC,OAAO;QACV,MAAM,IAAI,MAAM;IAClB;IAEA,IAAI,MAAM,MAAM,KAAK,QAAQ,IAAI,CAAC,EAAE,EAAE;QACpC,MAAM,IAAI,MAAM;IAClB;IAEA,OAAO;AACT;AAEO,eAAe,aAAa,EACjC,GAAG,EACH,UAAU,EAIX;IACC,MAAM,UAAU,MAAM,WAAW;QAAE;IAAI;IACvC,IAAI,CAAC,SAAS;QACZ,OAAO;IACT;IAEA,MAAM,QAAQ,MAAM,2IAAM,CAAC,KAAK,CAAC,UAAU,CAAC;QAC1C,OAAO;YAAE;QAAW;QACpB,QAAQ;YAAE,QAAQ;QAAK;IACzB;IAEA,IAAI,CAAC,OAAO;QACV,OAAO;IACT;IAEA,OAAO,MAAM,MAAM,KAAK,QAAQ,IAAI,CAAC,EAAE;AACzC"}},
    {"offset": {"line": 181, "column": 0}, "map": {"version":3,"sources":["file:///Users/devinat1/Desktop/projects/work-queue/apps/web/pages/api/slack/status.ts"],"sourcesContent":["import type { NextApiRequest, NextApiResponse } from \"next\";\nimport { prisma } from \"@work-queue/db-client\";\nimport { getSession } from \"@helpers/api/auth\";\n\nexport default async function handler(\n  req: NextApiRequest,\n  res: NextApiResponse\n) {\n  if (req.method !== \"GET\") {\n    res.setHeader(\"Allow\", [\"GET\"]);\n    return res.status(405).end();\n  }\n\n  try {\n    const session = await getSession({ req });\n\n    if (!session) {\n      return res.status(401).json({ error: \"Unauthorized\" });\n    }\n\n    const slackIntegration = await prisma.slackIntegration.findUnique({\n      where: { userId: session.user.id },\n      select: {\n        slackTeamId: true,\n        createdAt: true,\n      },\n    });\n\n    return res.status(200).json({\n      connected: slackIntegration !== null,\n      slackTeamId: slackIntegration?.slackTeamId ?? null,\n      connectedAt: slackIntegration?.createdAt ?? null,\n    });\n  } catch (error) {\n    console.error(\"Failed to get Slack status.\", error);\n    return res.status(500).json({ error: \"Failed to get Slack status.\" });\n  }\n}\n"],"names":[],"mappings":";;;;AACA;AACA;;;;;;;;AAEe,eAAe,QAC5B,GAAmB,EACnB,GAAoB;IAEpB,IAAI,IAAI,MAAM,KAAK,OAAO;QACxB,IAAI,SAAS,CAAC,SAAS;YAAC;SAAM;QAC9B,OAAO,IAAI,MAAM,CAAC,KAAK,GAAG;IAC5B;IAEA,IAAI;QACF,MAAM,UAAU,MAAM,IAAA,4IAAU,EAAC;YAAE;QAAI;QAEvC,IAAI,CAAC,SAAS;YACZ,OAAO,IAAI,MAAM,CAAC,KAAK,IAAI,CAAC;gBAAE,OAAO;YAAe;QACtD;QAEA,MAAM,mBAAmB,MAAM,2IAAM,CAAC,gBAAgB,CAAC,UAAU,CAAC;YAChE,OAAO;gBAAE,QAAQ,QAAQ,IAAI,CAAC,EAAE;YAAC;YACjC,QAAQ;gBACN,aAAa;gBACb,WAAW;YACb;QACF;QAEA,OAAO,IAAI,MAAM,CAAC,KAAK,IAAI,CAAC;YAC1B,WAAW,qBAAqB;YAChC,aAAa,kBAAkB,eAAe;YAC9C,aAAa,kBAAkB,aAAa;QAC9C;IACF,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,+BAA+B;QAC7C,OAAO,IAAI,MAAM,CAAC,KAAK,IAAI,CAAC;YAAE,OAAO;QAA8B;IACrE;AACF"}}]
}